<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Random YouTube Player</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background:#111; 
      color:#fff; 
      text-align:center; 
      margin:0; 
      padding:20px; 
    }
    #player { 
      width:80%; 
      max-width:800px; 
      aspect-ratio:16/9; 
      margin-top:20px; 
    }
    #counter { 
      margin-top:20px; 
      font-size:20px; 
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¥ Random YouTube Player</h1>
  <div id="player"></div>
  <div id="counter">Videos Played: 0</div>

  <!-- Load YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let lastVideo = null;

    // Called by YouTube API
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: '',
        playerVars: {
          autoplay: 1,
          controls: 1,
          mute: 1,    // force autoplay by muting
          rel: 0
        }
      });

      // Start fetching backend status
      setInterval(fetchStatus, 5000);
      fetchStatus();
    }

    async function fetchStatus() {
      try {
        const res = await fetch("/status");
        const data = await res.json();

        // If backend switched video, update the player
        if (data.currentVideo && data.currentVideo !== lastVideo) {
          player.loadVideoById(data.currentVideo);
          lastVideo = data.currentVideo;
        }

        // Update counter
        document.getElementById("counter").innerText = 
          "Videos Played: " + data.videoCount;

      } catch (err) {
        console.error("Error fetching status:", err);
      }
    }
  </script>
</body>
</html>
